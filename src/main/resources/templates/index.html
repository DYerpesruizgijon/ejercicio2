<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Enciclopedia de Plantas</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
  </head>
  <body>
    <h1>Enciclopedia de Plantas</h1>

    <!-- logica para el iniciar sesion o no  -->
    <div class="nav-links">
      <div th:if="${#authentication.principal == 'anonymousUser'}">
        <a th:href="@{/login}" class="btn-login">INICIAR SESIÓN</a>
      </div>

      <div th:if="${#authentication.principal != 'anonymousUser'}">
        
        <a th:href="@{/add}" class="btn-add">Agregar Nueva Planta</a>

        <form th:action="@{/logout}" method="post" style="display: inline">
          <button type="submit" class="btn-logout">Cerrar Sesión</button>
        </form>

        <span class="user-info">
          Hola, <b th:text="${#authentication.name}">Usuario</b> (Rango:
          <span
            th:text="${usuarioActual != null ? usuarioActual.getRango() : 'Semilla'}"
          ></span
          >)
        </span>

      </div>
    </div>

    <p th:if="${usuarioActual != null}">
      Tus puntos: <span th:text="${usuarioActual.puntos}"></span> Rango:
      <span th:text="${usuarioActual.getRango()}"></span>
    </p>

    <table border="1">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Imagen</th>
          <th>Nombre</th>
          <th>Tipo</th>
          <th>Altura (M)</th>
          <th>Ubicación</th>
          <th>Rareza</th>
          <th>Notas de Campo</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="planta : ${plantas}">
          <td
            th:text="${planta.creador != null ? planta.creador : 'Anónimo'}"
          ></td>
          <td>
            <img
              th:if="${planta.fotoUrl != null}"
              th:src="${planta.fotoUrl}"
              alt="Foto planta"
              style="
                width: 80px;
                height: 80px;
                object-fit: cover;
                border-radius: 8px;
              "
            />
            <span th:if="${planta.fotoUrl == null}">Sin foto</span>
          </td>
          <td th:text="${planta.nombre}"></td>
          <td
            th:text="${planta.tipo != null ? planta.tipo.nombre : 'Sin tipo'}"
          ></td>
          <td th:text="${planta.altura}"></td>
          <td th:text="${planta.ubicacion}"></td>
          <td th:text="${planta.rareza}"></td>
          <td th:text="${planta.notasCampo}"></td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
